# åˆ†ä¸ºã€Œå®šé•¿æ•°æ®ã€ ä¸ ã€Œä¸å®šé•¿æ•°æ®ã€ã€‚

# å®šé•¿æ•°æ®

å¯¹äºå®šé•¿çš„æ•°æ®åŒ…è€Œè¨€ï¼Œå‘é€ç«¯åœ¨å‘é€æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®¾ç½® Content-Length,æ¥æŒ‡æ˜å‘é€æ•°æ®çš„é•¿åº¦ã€‚

å½“ç„¶äº†å¦‚æœé‡‡ç”¨äº† Gzip å‹ç¼©çš„è¯ï¼ŒContent-Length è®¾ç½®çš„å°±æ˜¯å‹ç¼©åçš„ä¼ è¾“é•¿åº¦ã€‚

æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“çš„æ˜¯ ğŸ‘‡

1.  Content-Length å¦‚æœå­˜åœ¨å¹¶ä¸”æœ‰æ•ˆçš„è¯ï¼Œåˆ™å¿…é¡»å’Œæ¶ˆæ¯å†…å®¹çš„ä¼ è¾“é•¿åº¦å®Œå…¨ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¿‡çŸ­å°±ä¼šæˆªæ–­ï¼Œè¿‡é•¿çš„è¯ï¼Œå°±ä¼šå¯¼è‡´è¶…æ—¶ã€‚

2.  å¦‚æœé‡‡ç”¨çŸ­é“¾æ¥çš„è¯ï¼Œç›´æ¥å¯ä»¥é€šè¿‡æœåŠ¡å™¨å…³é—­è¿æ¥æ¥ç¡®å®šæ¶ˆæ¯çš„ä¼ è¾“é•¿åº¦ã€‚

3.  é‚£ä¹ˆåœ¨ HTTP/1.0 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒContent-Length å­—æ®µå¯æœ‰å¯æ— ,å› ä¸ºä¸€æ—¦æœåŠ¡å™¨å…³é—­è¿æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°ä¼ è¾“æ•°æ®çš„é•¿åº¦äº†ã€‚

4.  åœ¨ HTTP/1.1 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœæ˜¯ Keep-alive çš„è¯ï¼Œchunked ä¼˜å…ˆçº§é«˜äº Content-Length,è‹¥æ˜¯é Keep-aliveï¼Œè·Ÿå‰é¢æƒ…å†µä¸€æ ·ï¼ŒContent-Length å¯æœ‰å¯æ— ã€‚

é‚£æ€ä¹ˆæ¥è®¾ç½® Content-Length?

```
const server = require('http').createServer();
server.on('request', (req, res) => {
  if(req.url === '/index') {
   // è®¾ç½®æ•°æ®ç±»å‹
    res.setHeader('Content-Type', 'text/plain');
    res.setHeader('Content-Length', 10);
    res.write("ä½ å¥½ï¼Œä½¿ç”¨çš„æ˜¯Content-Lengthè®¾ç½®ä¼ è¾“æ•°æ®å½¢å¼");
  }
})

server.listen(3000, () => {
  console.log("æˆåŠŸå¯åŠ¨--TinaTian");
})
```

# ä¸å®šé•¿æ•°æ®

ç°åœ¨é‡‡ç”¨æœ€å¤šçš„å°±æ˜¯ HTTP/1.1 ç‰ˆæœ¬ï¼Œæ¥å®Œæˆä¼ è¾“æ•°æ®ï¼Œåœ¨ä¿å­˜ Keep-alive çŠ¶æ€ä¸‹ï¼Œå½“æ•°æ®æ˜¯ä¸å®šé•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®æ–°çš„å¤´éƒ¨å­—æ®µ ğŸ‘‡

```
Transfer-Encoding: chunked

```

é€šè¿‡ chunked æœºåˆ¶ï¼Œå¯ä»¥å®Œæˆå¯¹ä¸å®šé•¿æ•°æ®çš„å¤„ç†ï¼Œå½“ç„¶äº†ï¼Œä½ éœ€è¦çŸ¥é“çš„æ˜¯

1. å¦‚æœå¤´éƒ¨ä¿¡æ¯ä¸­æœ‰ Transfer-Encoding,ä¼˜å…ˆé‡‡ç”¨ Transfer-Encoding é‡Œé¢çš„æ–¹æ³•æ¥æ‰¾åˆ°å¯¹åº”çš„é•¿åº¦ã€‚

2. å¦‚æœè®¾ç½®äº† Transfer-Encodingï¼Œé‚£ä¹ˆ Content-Length å°†è¢«å¿½è§†ã€‚

3. ä½¿ç”¨é•¿è¿æ¥çš„è¯ï¼Œä¼šæŒç»­çš„æ¨é€åŠ¨æ€å†…å®¹

```
const server = require('http').createServer();
server.on('request', (req, res) => {
  if(req.url === '/index') {
   // è®¾ç½®æ•°æ®ç±»å‹
    res.setHeader('Content-Type', 'text/html; charset=utf8');
    res.setHeader('Content-Length', 10);
    res.setHeader('Transfer-Encoding', 'chunked');

    res.write("ä½ å¥½ï¼Œä½¿ç”¨çš„æ˜¯Transfer-Encodingè®¾ç½®ä¼ è¾“æ•°æ®å½¢å¼");
    setTimeout(() => {
      res.write("ç¬¬ä¸€æ¬¡ä¼ è¾“æ•°æ®ç»™æ‚¨<br/>");
    }, 1000);
    res.write("éªšç­‰ä¸€ä¸‹");
    setTimeout(() => {
      res.write("ç¬¬ä¸€æ¬¡ä¼ è¾“æ•°æ®ç»™æ‚¨");
      res.end()
    }, 3000);
  }
})

server.listen(3000, () => {
  console.log("æˆåŠŸå¯åŠ¨--TinaTian");
})
```
